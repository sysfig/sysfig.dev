<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noindex"><title>Testing Basics - sysfig</title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel=stylesheet><link rel=stylesheet href=https://sysfig.dev/style.css></head><body><header><div id=menu-button></div><nav id=main-nav><a class=main-nav__link href=/series>Series</a>
<a class=main-nav__link href=/posts>Posts</a>
<a id=main-nav__home-link class=main-nav__link href=/><span id=header-text-logo>sysfig.dev</span><div id=header-logo class=logo></div></a><a class=main-nav__link href=/projects>Projects</a>
<a class=main-nav__link href=/now>Now</a></nav></header><main><div class="single series-post"><h1 class=title>Testing Basics</h1><div class=page-meta>// 30 Dec 20<span class=separator>&bull;</span><div class=tag><a href=/tags/golang/>golang</a></div><div class=tag><a href=/tags/testing/>testing</a></div></div><div class=series-post-header>This post is part T1 of the series .</div><div class=content><p>Let&rsquo;s say we have an exported function called <code>Factorial</code> in <code>math.go</code></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>math</span>

<span style=color:#75715e>// Factorial - Get the factorial of a positive integer
</span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>uint64</span> {
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>n</span> &lt; <span style=color:#ae81ff>2</span> {
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
  }
  <span style=color:#66d9ef>return</span> uint64(<span style=color:#a6e22e>n</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
}
</code></pre></div><p>We can write a unit test for it in the same package (i.e. same directory) without importing it. The name of the file should end in <code>_test.go</code> (e.g. <code>math_test.go</code>). Any files named with the <code>_test.go</code> suffix will be excluded from the normal build but included when the <code>go test</code> command is run. A test file (<code>*_test.go</code>) can contain more than one test routine, but since we only have one function to test, we only need one test routine here.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>package</span> <span style=color:#a6e22e>math</span>

<span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;testing&#34;</span>

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestFactorial</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
  <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#ae81ff>4</span>)
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>24</span> {
    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Factorial(%d) = %d, want %d&#34;</span>, <span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>24</span>)
  }
}
</code></pre></div><blockquote><p>If your tests are in a different package, the functions under test <em>must</em> be exported and you&rsquo;d have to import them.</p></blockquote><p>Test routines have the form <code>func TestXxx(*testing.T)</code>. The only requirement for test routines names is that they begin with <code>Test</code> followed by a capital letter (e.g. <code>TestX</code>), but the convention is to follow <code>Test</code> by the name of the function you are testing (e.g. <code>TestFactorial</code>).</p><p>The test routines is passed a pointer to <a href=https://golang.org/pkg/testing/#T><code>testing.T</code></a>, which is an object that keeps track of the test suite&rsquo;s state. You can report the result of each test by using a subset of its methods:</p><ul><li><a href=https://golang.org/pkg/testing/#T.Log><code>t.Log</code></a> - prints out some text to the error log only when a test fails. Its behavior is the same as <code>fmt.Println</code>.</li><li><a href=https://golang.org/pkg/testing/#T.Logf><code>t.Logf</code></a> - similar to <code>t.Log</code> but output formatted text similar to <code>fmt.Printf</code>, instead of plain text like <code>fmt.Println</code>.</li><li><a href=https://golang.org/pkg/testing/#T.Fail><code>t.Fail</code></a> - marks a test as failed but continue executing any remaining test routines.</li><li><a href=https://golang.org/pkg/testing/#T.Error><code>t.Error</code></a> - analogous to running <code>t.Log()</code> followed by <code>t.Fail()</code>.</li><li><a href=https://golang.org/pkg/testing/#T.Errorf><code>t.Errorf</code></a> - analogous to running <code>t.Logf()</code> followed by <code>t.Fail()</code>.</li></ul><p>Within the test routine, you&rsquo;ll prepare parameters, pass them into the function under test, and check that the result is what you expect. If the result is wrong, we can use the <code>t.Errorf</code> to indicate failure and print out an error message.</p><p>We can now run <code>go test</code> to run our test. This will make Go compile the package source files and test files in the current directory, and run the resulting binary.</p><p>If we run our test now, we will see that it passes (<code>ok</code>).</p><pre><code class=language-console data-lang=console>$ go test
PASS
ok      _/Users/sysfig/gotest   0.266s
</code></pre><p>The <code>go test</code> output also prints out the package name (<code>_/Users/sysfig/gotest</code>) as well as the time it took the test to execute (<code>0.266s</code>).</p><p>To make sure our tests are working (i.e. it reports a failure when there&rsquo;s a mistake), let&rsquo;s introduce an error into our <code>Factorial</code> function. Here, we are trying to short-circuit the function by returning early for arguments smaller than 3. This would work for all positive integers except for 0 (<code>0! == 1</code>).</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>uint64</span> {
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>n</span> &lt; <span style=color:#ae81ff>3</span> {
    <span style=color:#66d9ef>return</span> uint64(<span style=color:#a6e22e>n</span>)
  }
  <span style=color:#66d9ef>return</span> uint64(<span style=color:#a6e22e>n</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
}
</code></pre></div><p>When we re-run our tests, the error does not surface because we didn&rsquo;t test against <code>0</code>.</p><pre><code class=language-console data-lang=console>$ go test
PASS
ok      _/Users/sysfig/gotest   0.261s
</code></pre><p>We rely on tests to tell us when and where our code&rsquo;s logic doesn&rsquo;t meet our expectations. So when a test passes when we know the logic is wrong, it&rsquo;s a bad test. To make it more robust, we can test against more values.</p><h3 id=testing-multiple-values>Testing Multiple Values</h3><p>Instead of testing just the factorial of <code>4</code>, we can try a wider range of numbers - zero, negative numbers, large numbers, etc.</p><p>So let&rsquo;s add a new test case into our test routine.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestFactorial</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>result</span> <span style=color:#66d9ef>uint64</span>
  <span style=color:#a6e22e>result</span> = <span style=color:#a6e22e>Factorial</span>(<span style=color:#ae81ff>0</span>)
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>1</span> {
    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Factorial(%d) = %d, want %d&#34;</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>1</span>)
  }
  <span style=color:#a6e22e>result</span> = <span style=color:#a6e22e>Factorial</span>(<span style=color:#ae81ff>4</span>)
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>!=</span> <span style=color:#ae81ff>24</span> {
    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Factorial(%d) = %d, want %d&#34;</span>, <span style=color:#ae81ff>4</span>, <span style=color:#a6e22e>result</span>, <span style=color:#ae81ff>24</span>)
  }
}
</code></pre></div><p>Now when we re-run the tests, it will fail.</p><pre><code class=language-console data-lang=console>$ go test
--- FAIL: TestFactorial (0.00s)
    math_test.go:9: Factorial(0) = 0, want 1
FAIL
exit status 1
FAIL    _/Users/sysfig/gotest   0.283s
</code></pre><blockquote><p>Note that the test case that passes did not print out anything, this is because we only call <code>testing.T</code>&rsquo;s reporting methods on failure, and not on success.</p></blockquote><p>However, the test logic for both test cases are the same and repeated in the code. To keep things DRY, a common programming practice is to store a map of inputs against expected output, and loop through the map.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestFactorial</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
  <span style=color:#a6e22e>testcases</span> <span style=color:#f92672>:=</span> []<span style=color:#66d9ef>struct</span> {
    <span style=color:#a6e22e>input</span>  <span style=color:#66d9ef>int</span>
    <span style=color:#a6e22e>output</span> <span style=color:#66d9ef>uint64</span>
  }{
    {<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>},
    {<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>},
    {<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>2</span>},
    {<span style=color:#ae81ff>3</span>, <span style=color:#ae81ff>6</span>},
    {<span style=color:#ae81ff>4</span>, <span style=color:#ae81ff>24</span>},
    {<span style=color:#ae81ff>10</span>, <span style=color:#ae81ff>3628800</span>},
    {<span style=color:#ae81ff>20</span>, <span style=color:#ae81ff>2432902008176640000</span>},
  }
  <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>testcase</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>testcases</span> {
    <span style=color:#a6e22e>result</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#a6e22e>testcase</span>.<span style=color:#a6e22e>input</span>)
    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>!=</span> <span style=color:#a6e22e>testcase</span>.<span style=color:#a6e22e>output</span> {
      <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Errorf</span>(<span style=color:#e6db74>&#34;Factorial(%d) = %d, want %d&#34;</span>, <span style=color:#a6e22e>testcase</span>.<span style=color:#a6e22e>input</span>, <span style=color:#a6e22e>result</span>, <span style=color:#a6e22e>testcase</span>.<span style=color:#a6e22e>output</span>)
    }
  }
}
</code></pre></div><p>This approach is also known as <em>table-driven tests</em>.</p><p><a href=https://dave.cheney.net/2013/06/09/writing-table-driven-tests-in-go>https://dave.cheney.net/2013/06/09/writing-table-driven-tests-in-go</a></p><p>Run <code>go test</code> again, and it will still report the one failing case for <code>0</code>.</p><pre><code class=language-console data-lang=console>$ go test
--- FAIL: TestFactorial (0.00s)
    math_test.go:21: Factorial(0) = 0, want 1
FAIL
exit status 1
FAIL    _/Users/sysfig/gotest   0.292s
</code></pre><p>But if we add an additional check that accounts for <code>0</code>:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#a6e22e>n</span> <span style=color:#66d9ef>int</span>) <span style=color:#66d9ef>uint64</span> {
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>n</span> &lt; <span style=color:#ae81ff>2</span> {
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>
  }
  <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>n</span> &lt; <span style=color:#ae81ff>3</span> {
    <span style=color:#66d9ef>return</span> uint64(<span style=color:#a6e22e>n</span>)
  }
  <span style=color:#66d9ef>return</span> uint64(<span style=color:#a6e22e>n</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>Factorial</span>(<span style=color:#a6e22e>n</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
}
</code></pre></div><p>All the test cases would once again pass.</p><pre><code class=language-console data-lang=console>$ go test       
PASS
ok      _/Users/sysfig/gotest   0.253s
</code></pre></div><div id=series-navigation><a class=prev href=/series/golang/testing/><div class=prev-button><img class=prev__arrow src=/img/arrow.svg><span class=prev__text>Prev</span></div><div class=prev__title><div class=chapter-order>T0</div><div class=prev__title__text>Testing</div></div></a><a class=next href=/series/golang/end-to-end-e2e-tests/><div class=next-button><span class=next__text>Next</span><img class=next__arrow src=/img/arrow.svg></div><div class=next__title><div class=prev__title__text>End-to-End Tests</div><div class=chapter-order>T99</div></div></a></div></div></main><footer><a href=/><div id=footer-logo-group><div id=footer-logo-base-rect></div><div id=footer-logo-base-circle></div><div id=footer-logo class=logo></div><div id=footer-text><span class=text-logo>sysfig.dev</span>
<span class=copyright>2021</span></div></div></a><div id=footer-about>I am a programmer and DevOps engineer on a quest to make education more accessible for all. <span class=text-logo>sysfig.dev</span> is an outlet for me to share my knowledge on the web, and also to showcase my projects.</div></footer><script src=/js/main.js></script></body></html>