<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noindex"><title>Web Storage API - sysfig</title><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel=stylesheet><link rel=stylesheet href=https://sysfig.dev/style.min.4f4914cba49496779c8262551ed1267f143018e125197d2b17d503fe0d39622e.css></head><body><header><div id=menu-button></div><nav id=main-nav><a class=main-nav__link href=/series>Series</a>
<a class=main-nav__link href=/posts>Posts</a>
<a id=main-nav__home-link class=main-nav__link href=/><span id=header-text-logo>sysfig.dev</span><div id=header-logo class=logo></div></a><a class=main-nav__link href=/projects>Projects</a>
<a class=main-nav__link href=/now>Now</a></nav></header><main><div class="single series-post"><h1 class=title>Web Storage API</h1><div class=page-meta>// 11 Feb 23</div><div class=series-post-header>This post is part W0 of the series <a class=series-post-header__series-title href=/series/browser-storage/>Browser storage</a>.</div><div class=content><p>The <em><a href=https://html.spec.whatwg.org/multipage/webstorage.html>Web Storage API</a></em> is a web API, maintained by <a href=WHATWG>https://whatwg.org/</a>, for storing string-only key-value pairs locally in the browser.</p><p>The Web Storage API provides two ways to store data - <code>localStorage</code> and <code>sessionStorage</code>. Both using the same API, but differs in how long the data persists for.</p><p>Data stored in <code>sessionStorage</code> persists only for that session, which is tied to a particular tab or window. If you open the same page on a new tab or window, that new tab/window is a new and completely different session, and have its own <code>sessionStorage</code> storage. Users can refresh the page without losing data, but when the tab/window is closed, the data is cleared.</p><p>On the other hand, data stored in <code>localStorage</code> persists until the user manually clears it via their browser settings, or until your application clears it.</p><p>In short, <code>sessionStorage</code> is meant for storage that spans a single window/tab, and <code>localStorage</code> is meant for storage that spans multiple windows/tabs</p><h2 id=check-for-support>Check for support</h2><p>According to <a href=https://caniuse.com/namevalue-storage>caniuse.com</a>, the Web Storage API is supported in 98.86% of browsers in use. However, some browsers (notably Opera Mini) does not support it, and many browsers disables it in incognito or private browsing modes.</p><p>Therefore, it&rsquo;s advisable to check for support by checking for the existence of the <code>localStorage</code> or <code>sessionStorage</code> object(s) under <code>window</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>localStorageIsAvailable() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#e6db74>&#39;localStorage&#39;</span> <span style=color:#66d9ef>in</span> window) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>testString</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;)*_()_a_random_string_(*&amp;%GUU)&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>storage</span>.<span style=color:#a6e22e>setItem</span>(<span style=color:#a6e22e>testString</span>, <span style=color:#a6e22e>testString</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>storage</span>.<span style=color:#a6e22e>removeItem</span>(<span style=color:#a6e22e>testString</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>localStorageIsAvailable</span>()) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Unsupported browser, ask user to use a supported browser
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>It&rsquo;s not enough to check for the existence of <code>window.localStorage</code> since some browsers implements <code>localStorage</code> but allocates it no storage quota. Therefore, the surest way to ensure <code>localStorage</code> is available is to <strong>use</strong> it, by setting and deleting values.</p><p>Once you&rsquo;ve confirmed that <code>localStorage</code> or <code>sessionStorage</code> is available, we are ready to start adding, reading, updating, and deleting data. Unlike other in-browser storage solutions like IndexedDB, there&rsquo;s no set-up required - you can just start using <code>localStorage</code>/<code>sessionStorage</code>.</p><h2 id=crud>CRUD</h2><p>The <code>localStorage</code>/<code>sessionStorage</code> objects follows the <a href=https://html.spec.whatwg.org/multipage/webstorage.html#the-storage-interface><code>Storage</code></a> interface, which defines the following methods:</p><ul><li><code>setItem(key, val)</code> - sets a key-value pair, replacing the existing record if it exists. Can be used to create a new record or to update an existing one.</li><li><code>getItem(key)</code> - used to get the value of a single record. If there are no records with that key, <code>null</code> is returned.</li><li><code>removeItem(key)</code> - removes a key-value pair by key</li><li><code>clear()</code> - clears all records</li><li><code>key(n)</code> - returns the key of the <code>n</code>th record, or <code>null</code> if <code>n</code> is equal or higher than the number of records. The iteration is not defined, and can change on most mutations. You should not rely on a record keeping the same index across mutations.</li></ul><p>Apart from using these methods, you can also treat <code>localStorage</code> as a dictionary (a string-only object) and manipulate its properties by accessing it directly. However, the return values may be different.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;foo&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>localStorage</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;bar&#39;</span>   <span style=color:#75715e>// =&gt; &#39;bar&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>localStorage</span>[<span style=color:#a6e22e>key</span>]           <span style=color:#75715e>// =&gt; &#39;bar&#39;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>delete</span> <span style=color:#a6e22e>localStorage</span>[<span style=color:#a6e22e>key</span>]    <span style=color:#75715e>// =&gt; `true`
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>localStorage</span>[<span style=color:#a6e22e>key</span>]           <span style=color:#75715e>// =&gt; `undefined` (not `null`)
</span></span></span></code></pre></div><p>The <code>Storage</code> interface specifies an additional read-only <code>length</code> property, which tells you the number of key-value pairs in <code>localStorage</code>/<code>sessionStorage</code>.</p><h2 id=iterating-through-all-records>Iterating through all records</h2><p>There are no native way to iterate over all items in <code>localStorage</code>/<code>sessionStorage</code>, but you can do it with a <code>for</code> or <code>while</code> loop and using the <code>key(n)</code> method.</p><p>For example, we can create a &lsquo;snapshot&rsquo; of <code>localStorage</code> using the following <code>for</code> loop:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>snapshot</span> <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>localStorage</span>.<span style=color:#a6e22e>length</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>localStorage</span>.<span style=color:#a6e22e>key</span>(<span style=color:#a6e22e>i</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>localStorage</span>.<span style=color:#a6e22e>getItem</span>(<span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>snapshot</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And here&rsquo;s the same functionality, but using a <code>while</code> loop:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>snapshot</span> <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>key</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>key</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>localStorage</span>.<span style=color:#a6e22e>key</span>(<span style=color:#a6e22e>i</span>)) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>localStorage</span>.<span style=color:#a6e22e>getItem</span>(<span style=color:#a6e22e>key</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>snapshot</span>[<span style=color:#a6e22e>key</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=events>Events</h2><p>Whenever a change is made to <code>localStorage</code>, the browser engine will fire a <code>storage</code> DOM event at <code>window</code> of <strong>other</strong> pages opened at the same origin, which other pages can listen to by adding an event handler with <code>window.addEventListener()</code>.</p><p>The <code>storage</code> event abides by the <a href=https://html.spec.whatwg.org/multipage/webstorage.html#storageevent><code>StorageEvent</code></a> interface, making the following readonly properties available:</p><ul><li><code>key</code> - the key of the record that has changed, or <code>null</code> if the event is caused by the <code>clear()</code> method</li><li><code>oldValue</code> - the value of the record before the change, which is <code>null</code> if the value is being created</li><li><code>newValue</code> - the value of the record after the change, which is <code>null</code> if the value is being deleted</li><li><code>url</code> - the URL of the document whose the storage item changed</li><li><code>storageArea</code> - the <code>localStorage</code> or <code>sessionStorage</code> object</li></ul><blockquote><p>The <code>StorageEvent</code> interface is an extension to the <a href=https://dom.spec.whatwg.org/#interface-event><code>Event</code></a> interface, so all the properties and methods available in <code>Event</code> is also available in <code>StorageEvent</code>.</p></blockquote><p>A common use case for listening to this event is to synchronize data between multiple tabs/windows running the same application.</p><blockquote><p>Events are <strong>not</strong> fired for <code>sessionStorage</code>, since different tabs/windows are considered different sessions.</p></blockquote><h2 id=errors>Errors</h2><p>Most browsers set a limit to the amount of data that each origin can store in <code>localStorage</code>/<code>sessionStorage</code>. If your application attempts to run <code>setItem(key, val)</code> that would cause this limit to be exceeded, the <code>QuotaExceededError</code> <code>DOMException</code> will be thrown (this error is called <code>NS_ERROR_DOM_QUOTA_REACHED</code> on Firefox). This error will also be thrown if the user has disabled storage for the origin.</p><p>A <code>SecurityError</code> <code>DOMException</code> can also be thrown if the browser prohibits the use of Web Storage API.</p></div><div id=series-navigation><a class=prev href=/series/browser-storage/z99_comparison/><div class=prev-button><img class=prev__arrow src=/img/arrow.svg><span class=prev__text>Prev</span></div><div class=prev__title><div class=chapter-order></div><div class=prev__title__text></div></div></a><a class=next href=/series/browser-storage/intro/><div class=next-button><span class=next__text>Next</span><img class=next__arrow src=/img/arrow.svg></div><div class=next__title><div class=prev__title__text>Introduction</div><div class=chapter-order>I0</div></div></a></div></div></main><footer><a href=/><div id=footer-logo-group><div id=footer-logo-base-rect></div><div id=footer-logo-base-circle></div><div id=footer-logo class=logo></div><div id=footer-text><span class=text-logo>sysfig.dev</span>
<span class=copyright>2023</span></div></div></a><div id=footer-about>I am a programmer and DevOps engineer on a quest to make education more accessible for all. <span class=text-logo>sysfig.dev</span> is an outlet for me to share my knowledge on the web, and also to showcase my projects.</div></footer><script src=/js/main.js></script></body></html>